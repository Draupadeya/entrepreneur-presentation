<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
    <link rel="stylesheet" href="{% static 'compare.css' %}">
    <style>
        .reveal { opacity: 0; transform: translateY(50px); }
        .bg-dark { background: #0b0f1a; }
        #bg3d { position: fixed; inset: 0; width: 100%; height: 100%; z-index: -10; pointer-events: none; }
    </style>
</head>
<body class="bg-dark text-white font-sans overflow-x-hidden">

    <canvas id="starfield" style="position:fixed;inset:0;z-index:-12;pointer-events:none;display:block;"></canvas>
    <canvas id="bg3d"></canvas>

    <section class="h-screen flex flex-col justify-center items-center text-center">
        <h1 id="hero-title" class="text-7xl font-bold mb-4">Success vs. <span class="text-red-500">Failure</span></h1>
        <p class="text-gray-400 text-xl">A case study analysis of grocery apps</p>
    </section>

    <section class="min-h-screen flex items-center justify-center p-10">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-20 w-full max-w-6xl">
            
            <div class="reveal p-10 border-l-4 border-red-500 bg-gray-900 rounded-lg block no-underline cursor-default">
                <h2 class="text-4xl font-bold mb-4">{{ data.pepper.name }}</h2>
                <div class="text-6xl font-black text-red-500 mb-2">{{ data.pepper.stat }}</div>
                <p class="text-gray-400 uppercase tracking-widest mb-6">{{ data.pepper.stat_label }}</p>
                <p class="text-lg leading-relaxed">{{ data.pepper.reason }}</p>
            </div>

            <div class="reveal p-10 border-l-4 border-blue-500 bg-gray-900 rounded-lg block no-underline cursor-default">
                <h2 class="text-4xl font-bold mb-4">{{ data.walmart.name }}</h2>
                <div class="text-6xl font-black text-blue-500 mb-2">{{ data.walmart.stat }}</div>
                <p class="text-gray-400 uppercase tracking-widest mb-6">{{ data.walmart.stat_label }}</p>
                <p class="text-lg leading-relaxed">{{ data.walmart.reason }}</p>
            </div>

        </div>
    </section>

    <!-- Interactive compare card -->
    <section class="py-12">
        <div class="max-w-6xl mx-auto px-6">
            <div id="compare-card" class="compare-card relative rounded-2xl overflow-hidden shadow-2xl bg-gradient-to-br from-white/3 to-white/2 border border-white/6 backdrop-blur-md">
                <div class="grid md:grid-cols-2">
                    <div class="panel left p-8">
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="cmp-logo" style="background-image: url('{{ compare.left.logo }}')"></div>
                            <div>
                                <h3 class="text-2xl font-bold">{{ compare.left.name }}</h3>
                                <div class="text-sm text-red-300">{{ compare.left.tag }}</div>
                            </div>
                        </div>

                        <ul class="space-y-3 mb-4">
                            {% for m in compare.left.metrics %}
                            <li class="flex justify-between text-gray-300"><span>{{ m.label }}</span><span class="metric-val" data-side="left">{{ m.value }}</span></li>
                            {% endfor %}
                        </ul>

                        <ul class="list-disc pl-5 text-gray-300 mb-6">
                            {% for l in compare.left.lessons %}
                            <li>{{ l }}</li>
                            {% endfor %}
                        </ul>

                        <a href="{% url 'detail' compare.left.slug %}" class="btn-ghost inline-block px-5 py-2 rounded-md border border-red-500 text-red-200">View case</a>
                    </div>

                    <div class="panel right p-8 bg-gradient-to-br from-black/10 to-black/5">
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="cmp-logo" style="background-image: url('{{ compare.right.logo }}')"></div>
                            <div>
                                <h3 class="text-2xl font-bold">{{ compare.right.name }}</h3>
                                <div class="text-sm text-blue-300">{{ compare.right.tag }}</div>
                            </div>
                        </div>

                        <ul class="space-y-3 mb-4">
                            {% for m in compare.right.metrics %}
                            <li class="flex justify-between text-gray-300"><span>{{ m.label }}</span><span class="metric-val" data-side="right">{{ m.value }}</span></li>
                            {% endfor %}
                        </ul>

                        <ul class="list-disc pl-5 text-gray-300 mb-6">
                            {% for l in compare.right.lessons %}
                            <li>{{ l }}</li>
                            {% endfor %}
                        </ul>

                        <a href="{% url 'detail' compare.right.slug %}" class="btn-ghost inline-block px-5 py-2 rounded-md border border-blue-500 text-blue-200">View case</a>
                    </div>
                </div>

                <!-- compare toggle removed per request -->
            </div>
        </div>
    </section>

    <script src="{% static 'compare.js' %}"></script>

    <script>
        gsap.registerPlugin(ScrollTrigger);

        // Hero Animation
        gsap.from("#hero-title", { opacity: 0, scale: 0.8, duration: 1.5, ease: "back.out(1.7)" });

        // Scroll Reveal Animations
        gsap.to(".reveal", {
            scrollTrigger: {
                trigger: ".reveal",
                start: "top 80%",
                toggleActions: "play none none reverse"
            },
            opacity: 1,
            y: 0,
            duration: 1,
            stagger: 0.3,
            ease: "power4.out"
        });
    </script>

    <!-- Grocery sprite 3D background -->
    <script>
        (function(){
            if(!window.THREE) return;

            const canvas = document.getElementById('bg3d');
            const renderer = new THREE.WebGLRenderer({canvas: canvas, alpha: true, antialias: true});
            renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
            renderer.setClearColor(0x0b0f1a, 0);

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 80;

            const ambient = new THREE.AmbientLight(0xffffff, 0.32);
            const dir = new THREE.DirectionalLight(0xffffff, 0.45);
            dir.position.set(0,1,1);
            scene.add(ambient, dir);

            // Generate soft blob textures instead of grocery PNGs
            const textures = [];
            function createBlobTexture(){
                const base1 = '#7fc3ff';
                const base2 = '#0b3b57';
                const c = document.createElement('canvas'); c.width=256; c.height=256; const ctx=c.getContext('2d');
                ctx.clearRect(0,0,256,256);
                const g = ctx.createRadialGradient(128,96,20,128,128,120); g.addColorStop(0,base1); g.addColorStop(1,base2);
                ctx.beginPath(); ctx.arc(128,128,120,0,Math.PI*2); ctx.closePath(); ctx.fillStyle=g; ctx.fill();
                ctx.globalCompositeOperation='lighter'; ctx.fillStyle='rgba(255,255,255,0.08)'; ctx.beginPath(); ctx.ellipse(92,92,56,36,0,0,Math.PI*2); ctx.fill();
                const t = new THREE.CanvasTexture(c); t.needsUpdate=true; return t;
            }
            for(let i=0;i<6;i++) textures.push(createBlobTexture());
            buildSprites();

            function buildSprites(){
                const ITEMS = 120;
                const sprites = [];
                for(let i=0;i<ITEMS;i++){
                    const tex = textures[Math.floor(Math.random()*textures.length)];
                    const mat = new THREE.SpriteMaterial({map:tex, transparent:true, opacity:0.96});
                    const sp = new THREE.Sprite(mat);
                    const baseX=(Math.random()-0.5)*220; const baseY=(Math.random()-0.5)*90; const baseZ=-Math.random()*240 - 20;
                    const s = 1.5 + Math.random()*2.5; sp.position.set(baseX, baseY, baseZ); sp.scale.set(s,s,1);
                    sp.userData={baseX,baseY,baseZ,s,speed:0.15+Math.random()*0.9}; scene.add(sp); sprites.push(sp);
                }

                const smallGeo = new THREE.SphereGeometry(0.22,6,6); const smallMat = new THREE.MeshBasicMaterial({color:0x7fc3ff, opacity:0.12, transparent:true});
                const smallCount = 140; const smallInst = new THREE.InstancedMesh(smallGeo, smallMat, smallCount); const tmp = new THREE.Object3D();
                for(let i=0;i<smallCount;i++){ tmp.position.set((Math.random()-0.5)*360,(Math.random()-0.5)*120,-Math.random()*420 - 40); tmp.updateMatrix(); smallInst.setMatrixAt(i,tmp.matrix);} scene.add(smallInst);

                let t=0; function animate(){ t+=0.01; for(let i=0;i<sprites.length;i++){ const sp=sprites[i]; const d=sp.userData; const ox = d.baseX + Math.sin(t*d.speed + i)*(6 + d.s*0.4); const oy = d.baseY + Math.cos(t*d.speed*0.7 + i)*(4 + d.s*0.18); const oz = d.baseZ + Math.sin(t*d.speed*0.5 + i)*6; sp.position.set(ox,oy,oz); const sc = d.s*(0.95 + 0.06*Math.sin(t*d.speed + i)); sp.scale.set(sc,sc,1);} camera.position.x=Math.sin(t*0.12)*6; camera.position.y=Math.sin(t*0.07)*3; camera.lookAt(0,0,0); renderer.render(scene,camera); requestAnimationFrame(animate);} animate();
            }

            function resize(){ const w=window.innerWidth,h=window.innerHeight; camera.aspect=w/h; camera.updateProjectionMatrix(); renderer.setSize(w,h); }
            window.addEventListener('resize', resize, {passive:true}); resize();
        })();
    </script>

        <!-- 2D starfield animation (lightweight) -->
        <script>
            (function(){
                const canvas = document.getElementById('starfield');
                if(!canvas) return;
                const ctx = canvas.getContext('2d');
                let W=0,H=0;
                function resize(){ W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
                window.addEventListener('resize', resize, {passive:true}); resize();

                const COUNT = 160;
                const stars = new Array(COUNT).fill(0).map(()=>({
                    x: Math.random()*W,
                    y: Math.random()*H,
                    r: Math.random()*1.0 + 0.3,
                    a: Math.random()*0.9 + 0.1,
                    tw: Math.random()*0.02 + 0.002,
                    vx: (Math.random()-0.5)*0.02,
                    vy: (Math.random()-0.5)*0.02
                }));

                let t = 0;
                function draw(){
                    t += 0.01;
                    ctx.clearRect(0,0,W,H);
                    for(let i=0;i<stars.length;i++){
                        const s = stars[i];
                        s.x += s.vx; s.y += s.vy;
                        if(s.x < -5) s.x = W+5; if(s.x > W+5) s.x = -5;
                        if(s.y < -5) s.y = H+5; if(s.y > H+5) s.y = -5;
                        const alpha = Math.max(0.04, Math.min(1, s.a + Math.sin(t*100*s.tw + i)*0.35));
                        ctx.globalAlpha = alpha;
                        ctx.fillStyle = '#dbefff';
                        ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill();
                    }
                    ctx.globalAlpha = 1;
                    requestAnimationFrame(draw);
                }
                draw();
            })();
        </script>
</body>
</html>